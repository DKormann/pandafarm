var qr=Object.defineProperty;var $r=(e,t,i)=>t in e?qr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var o=(e,t,i)=>($r(e,typeof t!="symbol"?t+"":t,i),i),st=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)};var s=(e,t,i)=>(st(e,t,"read from private field"),i?i.call(e):t.get(e)),m=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},T=(e,t,i,n)=>(st(e,t,"write to private field"),n?n.call(e,i):t.set(e,i),i);var g=(e,t,i)=>(st(e,t,"access private method"),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const p of a.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();class J{constructor(t){o(this,"value");o(this,"listeners",[]);this.value=t}get(){return this.value}set(t,i=!1){if(!(!i&&t===this.value)){for(const n of this.listeners)n(t);this.value=t}}update(t,i=!1){const n=t(this.value);this.set(n,i)}subscribe(t){this.listeners.push(t),t(this.value)}subscribeLater(t){this.listeners.push(t)}}class Hr extends J{constructor(i,n){localStorage.getItem(i)!==null&&(n=JSON.parse(localStorage.getItem(i)));super(n);o(this,"key");this.key=i}set(i){JSON.stringify(this.get())!==JSON.stringify(i)&&(super.set(i),localStorage.setItem(this.key,JSON.stringify(i)))}}var F,w,ur,de=(ur=class{constructor(e){m(this,F,void 0);m(this,w,0);T(this,F,new DataView(e.buffer)),T(this,w,e.byteOffset)}get offset(){return s(this,w)}readUInt8Array(){const e=this.readU32(),t=new Uint8Array(s(this,F).buffer,s(this,w),e);return T(this,w,s(this,w)+e),t}readBool(){const e=s(this,F).getUint8(s(this,w));return T(this,w,s(this,w)+1),e!==0}readByte(){const e=s(this,F).getUint8(s(this,w));return T(this,w,s(this,w)+1),e}readBytes(e){const t=new DataView(s(this,F).buffer,s(this,w),e);return T(this,w,s(this,w)+e),new Uint8Array(t.buffer)}readI8(){const e=s(this,F).getInt8(s(this,w));return T(this,w,s(this,w)+1),e}readU8(){const e=s(this,F).getUint8(s(this,w));return T(this,w,s(this,w)+1),e}readI16(){const e=s(this,F).getInt16(s(this,w),!0);return T(this,w,s(this,w)+2),e}readU16(){const e=s(this,F).getUint16(s(this,w),!0);return T(this,w,s(this,w)+2),e}readI32(){const e=s(this,F).getInt32(s(this,w),!0);return T(this,w,s(this,w)+4),e}readU32(){const e=s(this,F).getUint32(s(this,w),!0);return T(this,w,s(this,w)+4),e}readI64(){const e=s(this,F).getBigInt64(s(this,w),!0);return T(this,w,s(this,w)+8),e}readU64(){const e=s(this,F).getBigUint64(s(this,w),!0);return T(this,w,s(this,w)+8),e}readU128(){const e=s(this,F).getBigUint64(s(this,w),!0),t=s(this,F).getBigUint64(s(this,w)+8,!0);return T(this,w,s(this,w)+16),(t<<BigInt(64))+e}readI128(){const e=s(this,F).getBigUint64(s(this,w),!0),t=s(this,F).getBigInt64(s(this,w)+8,!0);return T(this,w,s(this,w)+16),(t<<BigInt(64))+e}readU256(){const e=s(this,F).getBigUint64(s(this,w),!0),t=s(this,F).getBigUint64(s(this,w)+8,!0),i=s(this,F).getBigUint64(s(this,w)+16,!0),n=s(this,F).getBigUint64(s(this,w)+24,!0);return T(this,w,s(this,w)+32),(n<<BigInt(3*64))+(i<<BigInt(2*64))+(t<<BigInt(1*64))+e}readI256(){const e=s(this,F).getBigUint64(s(this,w),!0),t=s(this,F).getBigUint64(s(this,w)+8,!0),i=s(this,F).getBigUint64(s(this,w)+16,!0),n=s(this,F).getBigInt64(s(this,w)+24,!0);return T(this,w,s(this,w)+32),(n<<BigInt(3*64))+(i<<BigInt(2*64))+(t<<BigInt(1*64))+e}readF32(){const e=s(this,F).getFloat32(s(this,w),!0);return T(this,w,s(this,w)+4),e}readF64(){const e=s(this,F).getFloat64(s(this,w),!0);return T(this,w,s(this,w)+8),e}readString(){const e=this.readU32(),t=new Uint8Array(s(this,F).buffer,s(this,w),e),n=new TextDecoder("utf-8").decode(t);return T(this,w,s(this,w)+e),n}},F=new WeakMap,w=new WeakMap,ur),M,P,S,R,x,dr,re=(dr=class{constructor(e){m(this,R);m(this,M,void 0);m(this,P,void 0);m(this,S,0);T(this,M,new Uint8Array(e)),T(this,P,new DataView(s(this,M).buffer))}getBuffer(){return s(this,M).slice(0,s(this,S))}writeUInt8Array(e){const t=e.length;g(this,R,x).call(this,4+t),this.writeU32(t),s(this,M).set(e,s(this,S)),T(this,S,s(this,S)+e.length)}writeBool(e){g(this,R,x).call(this,1),s(this,P).setUint8(s(this,S),e?1:0),T(this,S,s(this,S)+1)}writeByte(e){g(this,R,x).call(this,1),s(this,P).setUint8(s(this,S),e),T(this,S,s(this,S)+1)}writeI8(e){g(this,R,x).call(this,1),s(this,P).setInt8(s(this,S),e),T(this,S,s(this,S)+1)}writeU8(e){g(this,R,x).call(this,1),s(this,P).setUint8(s(this,S),e),T(this,S,s(this,S)+1)}writeI16(e){g(this,R,x).call(this,2),s(this,P).setInt16(s(this,S),e,!0),T(this,S,s(this,S)+2)}writeU16(e){g(this,R,x).call(this,2),s(this,P).setUint16(s(this,S),e,!0),T(this,S,s(this,S)+2)}writeI32(e){g(this,R,x).call(this,4),s(this,P).setInt32(s(this,S),e,!0),T(this,S,s(this,S)+4)}writeU32(e){g(this,R,x).call(this,4),s(this,P).setUint32(s(this,S),e,!0),T(this,S,s(this,S)+4)}writeI64(e){g(this,R,x).call(this,8),s(this,P).setBigInt64(s(this,S),e,!0),T(this,S,s(this,S)+8)}writeU64(e){g(this,R,x).call(this,8),s(this,P).setBigUint64(s(this,S),e,!0),T(this,S,s(this,S)+8)}writeU128(e){g(this,R,x).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),i=e>>BigInt(64);s(this,P).setBigUint64(s(this,S),t,!0),s(this,P).setBigUint64(s(this,S)+8,i,!0),T(this,S,s(this,S)+16)}writeI128(e){g(this,R,x).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),i=e>>BigInt(64);s(this,P).setBigInt64(s(this,S),t,!0),s(this,P).setBigInt64(s(this,S)+8,i,!0),T(this,S,s(this,S)+16)}writeU256(e){g(this,R,x).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),i=e&t,n=e>>BigInt(64*1)&t,r=e>>BigInt(64*2)&t,a=e>>BigInt(64*3);s(this,P).setBigUint64(s(this,S)+8*0,i,!0),s(this,P).setBigUint64(s(this,S)+8*1,n,!0),s(this,P).setBigUint64(s(this,S)+8*2,r,!0),s(this,P).setBigUint64(s(this,S)+8*3,a,!0),T(this,S,s(this,S)+32)}writeI256(e){g(this,R,x).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),i=e&t,n=e>>BigInt(64*1)&t,r=e>>BigInt(64*2)&t,a=e>>BigInt(64*3);s(this,P).setBigUint64(s(this,S)+8*0,i,!0),s(this,P).setBigUint64(s(this,S)+8*1,n,!0),s(this,P).setBigUint64(s(this,S)+8*2,r,!0),s(this,P).setBigInt64(s(this,S)+8*3,a,!0),T(this,S,s(this,S)+32)}writeF32(e){g(this,R,x).call(this,4),s(this,P).setFloat32(s(this,S),e,!0),T(this,S,s(this,S)+4)}writeF64(e){g(this,R,x).call(this,8),s(this,P).setFloat64(s(this,S),e,!0),T(this,S,s(this,S)+8)}writeString(e){const i=new TextEncoder().encode(e);this.writeU32(i.length),g(this,R,x).call(this,i.length),s(this,M).set(i,s(this,S)),T(this,S,s(this,S)+i.length)}},M=new WeakMap,P=new WeakMap,S=new WeakMap,R=new WeakSet,x=function(e){const t=s(this,S)+e+1;if(t<=s(this,M).length)return;let i=s(this,M).length*2;i<t&&(i=t);const n=new Uint8Array(i);n.set(s(this,M)),T(this,M,n),T(this,P,new DataView(s(this,M).buffer))},dr);function oe(e,t){if(e===t)return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(let r of i)if(!n.includes(r)||!oe(e[r],t[r]))return!1;return!0}function mr(e){return Array.prototype.map.call(e.reverse(),t=>("00"+t.toString(16)).slice(-2)).join("")}function Wr(e){if(e.length!=16)throw new Error(`Uint8Array is not 16 bytes long: ${e}`);return new de(e).readU128()}function Gr(e){if(e.length!=32)throw new Error(`Uint8Array is not 32 bytes long: [${e}]`);return new de(e).readU256()}function wr(e){e.startsWith("0x")&&(e=e.slice(2));let t=e.match(/.{1,2}/g)||[],i=Uint8Array.from(t.map(n=>parseInt(n,16)));return i.length!=32?new Uint8Array(0):i.reverse()}function Vr(e){return Wr(wr(e))}function Kr(e){return Gr(wr(e))}function Sr(e){let t=new re(16);return t.writeU128(e),t.getBuffer()}function Jr(e){return mr(Sr(e))}function Ar(e){let t=new re(32);return t.writeU256(e),t.getBuffer()}function Zr(e){return mr(Ar(e))}var at=class De{constructor(t){o(this,"data");this.data=t}get __connection_id__(){return this.data}isZero(){return this.data===BigInt(0)}static nullIfZero(t){return t.isZero()?null:t}static random(){function t(){return Math.floor(Math.random()*255)}let i=BigInt(0);for(let n=0;n<16;n++)i=i<<BigInt(8)|BigInt(t());return new De(i)}isEqual(t){return this.data==t.data}toHexString(){return Jr(this.data)}toUint8Array(){return Sr(this.data)}static fromString(t){return new De(Vr(t))}static fromStringOrNull(t){let i=De.fromString(t);return i.isZero()?null:i}},Q,jr=(Q=class{constructor(t){o(this,"__time_duration_micros__");this.__time_duration_micros__=t}get micros(){return this.__time_duration_micros__}get millis(){return Number(this.micros/Q.MICROS_PER_MILLIS)}static fromMillis(t){return new Q(BigInt(t)*Q.MICROS_PER_MILLIS)}},o(Q,"MICROS_PER_MILLIS",1000n),Q),H,Xr=(H=class{constructor(t){o(this,"__timestamp_micros_since_unix_epoch__");this.__timestamp_micros_since_unix_epoch__=t}get microsSinceUnixEpoch(){return this.__timestamp_micros_since_unix_epoch__}static now(){return H.fromDate(new Date)}static fromDate(t){const i=t.getTime(),n=BigInt(i)*H.MICROS_PER_MILLIS;return new H(n)}toDate(){const i=this.__timestamp_micros_since_unix_epoch__/H.MICROS_PER_MILLIS;if(i>BigInt(Number.MAX_SAFE_INTEGER)||i<BigInt(Number.MIN_SAFE_INTEGER))throw new RangeError("Timestamp is outside of the representable range of JS's Date");return new Date(Number(i))}},o(H,"MICROS_PER_MILLIS",1000n),o(H,"UNIX_EPOCH",new H(0n)),H),zr=class vr{constructor(t){o(this,"data");this.data=typeof t=="string"?Kr(t):t}get __identity__(){return this.data}isEqual(t){return this.toHexString()===t.toHexString()}toHexString(){return Zr(this.data)}toUint8Array(){return Ar(this.data)}static fromString(t){return new vr(t)}},ct;(e=>{function t(){return c.createSumType([new E("Interval",c.createU64Type()),new E("Time",c.createU64Type())])}e.getAlgebraicType=t;function i(r){switch(r.tag){case"Interval":return{Interval:r.value};case"Time":return{Time:r.value};default:throw"unreachable"}}e.serialize=i,e.Interval=r=>({tag:"Interval",value:r}),e.Time=r=>({tag:"Time",value:r});function n(r){let a=r.asSumValue();switch(a.tag){case 0:return{tag:"Interval",value:a.value.asBigInt()};case 1:return{tag:"Time",value:a.value.asBigInt()};default:throw"unreachable"}}e.fromValue=n})(ct||(ct={}));var Yr=ct,E=class{constructor(e,t){o(this,"name");o(this,"algebraicType");this.name=e,this.algebraicType=t}},Qr=class{constructor(e){o(this,"variants");o(this,"serialize",(e,t)=>{if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none")t?(e.writeByte(0),this.variants[0].algebraicType.serialize(e,t)):e.writeByte(1);else{let i=t.tag;const n=this.variants.findIndex(r=>r.name===i);if(n<0)throw`Can't serialize a sum type, couldn't find ${t.tag} tag`;e.writeU8(n),this.variants[n].algebraicType.serialize(e,t.value)}});o(this,"deserialize",e=>{let t=e.readU8();if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none"){if(t===0)return this.variants[0].algebraicType.deserialize(e);if(t===1)return;throw`Can't deserialize an option type, couldn't find ${t} tag`}else{let i=this.variants[t],n=i.algebraicType.deserialize(e);return{tag:i.name,value:n}}});this.variants=e}},l=class{constructor(e,t){o(this,"name");o(this,"algebraicType");this.name=e,this.algebraicType=t}},ei=class{constructor(e){o(this,"elements");o(this,"serialize",(e,t)=>{for(let i of this.elements)i.algebraicType.serialize(e,t[i.name])});o(this,"deserialize",e=>{let t={};if(this.elements.length===1){if(this.elements[0].name==="__time_duration_micros__")return new jr(e.readI64());if(this.elements[0].name==="__timestamp_micros_since_unix_epoch__")return new Xr(e.readI64());if(this.elements[0].name==="__identity__")return new zr(e.readU256());if(this.elements[0].name==="__connection_id__")return new at(e.readU128())}for(let i of this.elements)t[i.name]=i.algebraicType.deserialize(e);return t});this.elements=e}isEmpty(){return this.elements.length===0}},ti=class{constructor(e,t){o(this,"keyType");o(this,"valueType");this.keyType=e,this.valueType=t}},Z,pe,O,ye,B,ve,ot,Ie,lt,Ue,pt,c=(ye=class{constructor(){m(this,Z);m(this,ve);m(this,Ie);m(this,Ue);o(this,"type");o(this,"type_")}get product(){if(this.type!==u.ProductType)throw"product type was requested, but the type is not ProductType";return this.type_}set product(t){g(this,Z,pe).call(this,u.ProductType,t)}get sum(){if(this.type!==u.SumType)throw"sum type was requested, but the type is not SumType";return this.type_}set sum(t){g(this,Z,pe).call(this,u.SumType,t)}get array(){if(this.type!==u.ArrayType)throw"array type was requested, but the type is not ArrayType";return this.type_}set array(t){g(this,Z,pe).call(this,u.ArrayType,t)}get map(){if(this.type!==u.MapType)throw"map type was requested, but the type is not MapType";return this.type_}set map(t){g(this,Z,pe).call(this,u.MapType,t)}static createProductType(t){return g(this,O,B).call(this,u.ProductType,new ei(t))}static createSumType(t){return g(this,O,B).call(this,u.SumType,new Qr(t))}static createArrayType(t){return g(this,O,B).call(this,u.ArrayType,t)}static createMapType(t,i){return g(this,O,B).call(this,u.MapType,new ti(t,i))}static createBoolType(){return g(this,O,B).call(this,u.Bool,null)}static createI8Type(){return g(this,O,B).call(this,u.I8,null)}static createU8Type(){return g(this,O,B).call(this,u.U8,null)}static createI16Type(){return g(this,O,B).call(this,u.I16,null)}static createU16Type(){return g(this,O,B).call(this,u.U16,null)}static createI32Type(){return g(this,O,B).call(this,u.I32,null)}static createU32Type(){return g(this,O,B).call(this,u.U32,null)}static createI64Type(){return g(this,O,B).call(this,u.I64,null)}static createU64Type(){return g(this,O,B).call(this,u.U64,null)}static createI128Type(){return g(this,O,B).call(this,u.I128,null)}static createU128Type(){return g(this,O,B).call(this,u.U128,null)}static createI256Type(){return g(this,O,B).call(this,u.I256,null)}static createU256Type(){return g(this,O,B).call(this,u.U256,null)}static createF32Type(){return g(this,O,B).call(this,u.F32,null)}static createF64Type(){return g(this,O,B).call(this,u.F64,null)}static createStringType(){return g(this,O,B).call(this,u.String,null)}static createBytesType(){return this.createArrayType(this.createU8Type())}static createOptionType(t){return this.createSumType([new E("some",t),new E("none",this.createProductType([]))])}static createIdentityType(){return this.createProductType([new l("__identity__",this.createU256Type())])}static createConnectionIdType(){return this.createProductType([new l("__connection_id__",this.createU128Type())])}static createScheduleAtType(){return Yr.getAlgebraicType()}static createTimestampType(){return this.createProductType([new l("__timestamp_micros_since_unix_epoch__",this.createI64Type())])}static createTimeDurationType(){return this.createProductType([new l("__time_duration_micros__",this.createI64Type())])}isProductType(){return this.type===u.ProductType}isSumType(){return this.type===u.SumType}isArrayType(){return this.type===u.ArrayType}isMapType(){return this.type===u.MapType}isIdentity(){return g(this,Ie,lt).call(this,"__identity__")}isConnectionId(){return g(this,Ie,lt).call(this,"__connection_id__")}isScheduleAt(){return this.isSumType()&&this.sum.variants.length===2&&this.sum.variants[0].name==="Interval"&&this.sum.variants[0].algebraicType.type===u.U64&&this.sum.variants[1].name==="Time"&&this.sum.variants[1].algebraicType.type===u.U64}isTimestamp(){return g(this,Ue,pt).call(this,"__timestamp_micros_since_unix_epoch__")}isTimeDuration(){return g(this,Ue,pt).call(this,"__time_duration_micros__")}serialize(t,i){switch(this.type){case u.ProductType:this.product.serialize(t,i);break;case u.SumType:this.sum.serialize(t,i);break;case u.ArrayType:if(g(this,ve,ot).call(this))t.writeUInt8Array(i);else{const n=this.array;t.writeU32(i.length);for(let r of i)n.serialize(t,r)}break;case u.MapType:throw new Error("not implemented");case u.Bool:t.writeBool(i);break;case u.I8:t.writeI8(i);break;case u.U8:t.writeU8(i);break;case u.I16:t.writeI16(i);break;case u.U16:t.writeU16(i);break;case u.I32:t.writeI32(i);break;case u.U32:t.writeU32(i);break;case u.I64:t.writeI64(i);break;case u.U64:t.writeU64(i);break;case u.I128:t.writeI128(i);break;case u.U128:t.writeU128(i);break;case u.I256:t.writeI256(i);break;case u.U256:t.writeU256(i);break;case u.F32:t.writeF32(i);break;case u.F64:t.writeF64(i);break;case u.String:t.writeString(i);break;default:throw new Error(`not implemented, ${this.type}`)}}deserialize(t){switch(this.type){case u.ProductType:return this.product.deserialize(t);case u.SumType:return this.sum.deserialize(t);case u.ArrayType:if(g(this,ve,ot).call(this))return t.readUInt8Array();{const i=this.array,n=t.readU32();let r=[];for(let a=0;a<n;a++)r.push(i.deserialize(t));return r}case u.MapType:throw new Error("not implemented");case u.Bool:return t.readBool();case u.I8:return t.readI8();case u.U8:return t.readU8();case u.I16:return t.readI16();case u.U16:return t.readU16();case u.I32:return t.readI32();case u.U32:return t.readU32();case u.I64:return t.readI64();case u.U64:return t.readU64();case u.I128:return t.readI128();case u.U128:return t.readU128();case u.U256:return t.readU256();case u.F32:return t.readF32();case u.F64:return t.readF64();case u.String:return t.readString();default:throw new Error(`not implemented, ${this.type}`)}}},Z=new WeakSet,pe=function(t,i){this.type_=i,this.type=i===void 0?u.None:t},O=new WeakSet,B=function(t,i){var r;let n=new ye;return g(r=n,Z,pe).call(r,t,i),n},ve=new WeakSet,ot=function(){return this.isArrayType()&&this.array.type==u.U8},Ie=new WeakSet,lt=function(t){return this.isProductType()&&this.product.elements.length===1&&(this.product.elements[0].algebraicType.type==u.U128||this.product.elements[0].algebraicType.type==u.U256)&&this.product.elements[0].name===t},Ue=new WeakSet,pt=function(t){return this.isProductType()&&this.product.elements.length===1&&this.product.elements[0].algebraicType.type===u.I64&&this.product.elements[0].name===t},m(ye,O),ye);(e=>{(t=>{t.SumType="SumType",t.ProductType="ProductType",t.ArrayType="ArrayType",t.MapType="MapType",t.Bool="Bool",t.I8="I8",t.U8="U8",t.I16="I16",t.U16="U16",t.I32="I32",t.U32="U32",t.I64="I64",t.U64="U64",t.I128="I128",t.U128="U128",t.I256="I256",t.U256="U256",t.F32="F32",t.F64="F64",t.String="String",t.None="None"})(e.Type||(e.Type={}))})(c||(c={}));var u=c.Type;function ri(e,t){const i=new de(t);return e.deserialize(i)}var ut;(e=>{e.FixedSize=r=>({tag:"FixedSize",value:r}),e.RowOffsets=r=>({tag:"RowOffsets",value:r});function t(){return c.createSumType([new E("FixedSize",c.createU16Type()),new E("RowOffsets",c.createArrayType(c.createU64Type()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(ut||(ut={}));var ze;(e=>{function t(){return c.createProductType([new l("sizeHint",ut.getTypeScriptAlgebraicType()),new l("rowsData",c.createArrayType(c.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(ze||(ze={}));var dt;(e=>{function t(){return c.createProductType([new l("reducer",c.createStringType()),new l("args",c.createArrayType(c.createU8Type())),new l("requestId",c.createU32Type()),new l("flags",c.createU8Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(dt||(dt={}));var yt;(e=>{function t(){return c.createProductType([new l("queryStrings",c.createArrayType(c.createStringType())),new l("requestId",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(yt||(yt={}));var gt;(e=>{function t(){return c.createProductType([new l("messageId",c.createArrayType(c.createU8Type())),new l("queryString",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(gt||(gt={}));var G;(e=>{function t(){return c.createProductType([new l("id",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(G||(G={}));var ht;(e=>{function t(){return c.createProductType([new l("query",c.createStringType()),new l("requestId",c.createU32Type()),new l("queryId",G.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(ht||(ht={}));var Tt;(e=>{function t(){return c.createProductType([new l("queryStrings",c.createArrayType(c.createStringType())),new l("requestId",c.createU32Type()),new l("queryId",G.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Tt||(Tt={}));var bt;(e=>{function t(){return c.createProductType([new l("requestId",c.createU32Type()),new l("queryId",G.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(bt||(bt={}));var ft;(e=>{function t(){return c.createProductType([new l("requestId",c.createU32Type()),new l("queryId",G.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(ft||(ft={}));var ue;(e=>{e.CallReducer=r=>({tag:"CallReducer",value:r}),e.Subscribe=r=>({tag:"Subscribe",value:r}),e.OneOffQuery=r=>({tag:"OneOffQuery",value:r}),e.SubscribeSingle=r=>({tag:"SubscribeSingle",value:r}),e.SubscribeMulti=r=>({tag:"SubscribeMulti",value:r}),e.Unsubscribe=r=>({tag:"Unsubscribe",value:r}),e.UnsubscribeMulti=r=>({tag:"UnsubscribeMulti",value:r});function t(){return c.createSumType([new E("CallReducer",dt.getTypeScriptAlgebraicType()),new E("Subscribe",yt.getTypeScriptAlgebraicType()),new E("OneOffQuery",gt.getTypeScriptAlgebraicType()),new E("SubscribeSingle",ht.getTypeScriptAlgebraicType()),new E("SubscribeMulti",Tt.getTypeScriptAlgebraicType()),new E("Unsubscribe",bt.getTypeScriptAlgebraicType()),new E("UnsubscribeMulti",ft.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(ue||(ue={}));var Ne;(e=>{function t(){return c.createProductType([new l("deletes",ze.getTypeScriptAlgebraicType()),new l("inserts",ze.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Ne||(Ne={}));var mt;(e=>{e.Uncompressed=r=>({tag:"Uncompressed",value:r}),e.Brotli=r=>({tag:"Brotli",value:r}),e.Gzip=r=>({tag:"Gzip",value:r});function t(){return c.createSumType([new E("Uncompressed",Ne.getTypeScriptAlgebraicType()),new E("Brotli",c.createArrayType(c.createU8Type())),new E("Gzip",c.createArrayType(c.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(mt||(mt={}));var qe;(e=>{function t(){return c.createProductType([new l("tableId",c.createU32Type()),new l("tableName",c.createStringType()),new l("numRows",c.createU64Type()),new l("updates",c.createArrayType(mt.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(qe||(qe={}));var le;(e=>{function t(){return c.createProductType([new l("tables",c.createArrayType(qe.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(le||(le={}));var wt;(e=>{function t(){return c.createProductType([new l("quanta",c.createU128Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(wt||(wt={}));var St;(e=>{function t(){return c.createProductType([new l("identity",c.createIdentityType()),new l("token",c.createStringType()),new l("connectionId",c.createConnectionIdType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(St||(St={}));var At;(e=>{function t(){return c.createProductType([new l("databaseUpdate",le.getTypeScriptAlgebraicType()),new l("requestId",c.createU32Type()),new l("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(At||(At={}));var zt;(e=>{function t(){return c.createProductType([new l("tableName",c.createStringType()),new l("rows",ze.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(zt||(zt={}));var vt;(e=>{function t(){return c.createProductType([new l("messageId",c.createArrayType(c.createU8Type())),new l("error",c.createOptionType(c.createStringType())),new l("tables",c.createArrayType(zt.getTypeScriptAlgebraicType())),new l("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(vt||(vt={}));var It;(e=>{function t(){return c.createProductType([new l("reducerName",c.createStringType()),new l("reducerId",c.createU32Type()),new l("args",c.createArrayType(c.createU8Type())),new l("requestId",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(It||(It={}));var Ut;(e=>{e.Committed=r=>({tag:"Committed",value:r}),e.Failed=r=>({tag:"Failed",value:r}),e.OutOfEnergy={tag:"OutOfEnergy"};function t(){return c.createSumType([new E("Committed",le.getTypeScriptAlgebraicType()),new E("Failed",c.createStringType()),new E("OutOfEnergy",c.createProductType([]))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Ut||(Ut={}));var _t;(e=>{function t(){return c.createProductType([new l("status",Ut.getTypeScriptAlgebraicType()),new l("timestamp",c.createTimestampType()),new l("callerIdentity",c.createIdentityType()),new l("callerConnectionId",c.createConnectionIdType()),new l("reducerCall",It.getTypeScriptAlgebraicType()),new l("energyQuantaUsed",wt.getTypeScriptAlgebraicType()),new l("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(_t||(_t={}));var Ct;(e=>{function t(){return c.createProductType([new l("requestId",c.createU32Type()),new l("update",le.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Ct||(Ct={}));var $e;(e=>{function t(){return c.createProductType([new l("tableId",c.createU32Type()),new l("tableName",c.createStringType()),new l("tableRows",qe.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})($e||($e={}));var Et;(e=>{function t(){return c.createProductType([new l("requestId",c.createU32Type()),new l("totalHostExecutionDurationMicros",c.createU64Type()),new l("queryId",G.getTypeScriptAlgebraicType()),new l("rows",$e.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Et||(Et={}));var Ft;(e=>{function t(){return c.createProductType([new l("requestId",c.createU32Type()),new l("totalHostExecutionDurationMicros",c.createU64Type()),new l("queryId",G.getTypeScriptAlgebraicType()),new l("rows",$e.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Ft||(Ft={}));var kt;(e=>{function t(){return c.createProductType([new l("totalHostExecutionDurationMicros",c.createU64Type()),new l("requestId",c.createOptionType(c.createU32Type())),new l("queryId",c.createOptionType(c.createU32Type())),new l("tableId",c.createOptionType(c.createU32Type())),new l("error",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(kt||(kt={}));var Pt;(e=>{function t(){return c.createProductType([new l("requestId",c.createU32Type()),new l("totalHostExecutionDurationMicros",c.createU64Type()),new l("queryId",G.getTypeScriptAlgebraicType()),new l("update",le.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Pt||(Pt={}));var Ot;(e=>{function t(){return c.createProductType([new l("requestId",c.createU32Type()),new l("totalHostExecutionDurationMicros",c.createU64Type()),new l("queryId",G.getTypeScriptAlgebraicType()),new l("update",le.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Ot||(Ot={}));var Bt;(e=>{e.InitialSubscription=r=>({tag:"InitialSubscription",value:r}),e.TransactionUpdate=r=>({tag:"TransactionUpdate",value:r}),e.TransactionUpdateLight=r=>({tag:"TransactionUpdateLight",value:r}),e.IdentityToken=r=>({tag:"IdentityToken",value:r}),e.OneOffQueryResponse=r=>({tag:"OneOffQueryResponse",value:r}),e.SubscribeApplied=r=>({tag:"SubscribeApplied",value:r}),e.UnsubscribeApplied=r=>({tag:"UnsubscribeApplied",value:r}),e.SubscriptionError=r=>({tag:"SubscriptionError",value:r}),e.SubscribeMultiApplied=r=>({tag:"SubscribeMultiApplied",value:r}),e.UnsubscribeMultiApplied=r=>({tag:"UnsubscribeMultiApplied",value:r});function t(){return c.createSumType([new E("InitialSubscription",At.getTypeScriptAlgebraicType()),new E("TransactionUpdate",_t.getTypeScriptAlgebraicType()),new E("TransactionUpdateLight",Ct.getTypeScriptAlgebraicType()),new E("IdentityToken",St.getTypeScriptAlgebraicType()),new E("OneOffQueryResponse",vt.getTypeScriptAlgebraicType()),new E("SubscribeApplied",Et.getTypeScriptAlgebraicType()),new E("UnsubscribeApplied",Ft.getTypeScriptAlgebraicType()),new E("SubscriptionError",kt.getTypeScriptAlgebraicType()),new E("SubscribeMultiApplied",Pt.getTypeScriptAlgebraicType()),new E("UnsubscribeMultiApplied",Ot.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Bt||(Bt={}));var ne,yr,it=(yr=class{constructor(){m(this,ne,new Map)}on(e,t){let i=s(this,ne).get(e);i||(i=new Set,s(this,ne).set(e,i)),i.add(t)}off(e,t){let i=s(this,ne).get(e);!i||i.delete(t)}emit(e,...t){let i=s(this,ne).get(e);if(!!i)for(let n of i)n(...t)}},ne=new WeakMap,yr),N,se,Se,gr,cr=(gr=class{constructor(){m(this,se);m(this,N,[])}set(e,t){const i=s(this,N).findIndex(({key:n})=>g(this,se,Se).call(this,n,e));i>-1?s(this,N)[i].value=t:s(this,N).push({key:e,value:t})}get(e){const t=s(this,N).find(({key:i})=>g(this,se,Se).call(this,i,e));return t?t.value:void 0}delete(e){const t=s(this,N).findIndex(({key:i})=>g(this,se,Se).call(this,i,e));return t>-1?(s(this,N).splice(t,1),!0):!1}has(e){return s(this,N).some(({key:t})=>g(this,se,Se).call(this,t,e))}values(){return s(this,N).map(e=>e.value)}entries(){return s(this,N)}[Symbol.iterator](){let e=0;const t=s(this,N);return{next(){return e<t.length?{value:t[e++],done:!1}:{value:null,done:!0}}}}},N=new WeakMap,se=new WeakSet,Se=function(e,t){return e&&typeof e=="object"&&"isEqual"in e?e.isEqual(t):e===t},gr),ii={component:"\u{1F4E6}",info:"\u2139\uFE0F",warn:"\u26A0\uFE0F",error:"\u274C",debug:"\u{1F41B}"},ni={component:"color: #fff; background-color: #8D6FDD; padding: 2px 5px; border-radius: 3px;",info:"color: #fff; background-color: #007bff; padding: 2px 5px; border-radius: 3px;",warn:"color: #fff; background-color: #ffc107; padding: 2px 5px; border-radius: 3px;",error:"color: #fff; background-color: #dc3545; padding: 2px 5px; border-radius: 3px;",debug:"color: #fff; background-color: #28a745; padding: 2px 5px; border-radius: 3px;"},si={component:"color: #8D6FDD;",info:"color: #007bff;",warn:"color: #ffc107;",error:"color: #dc3545;",debug:"color: #28a745;"},ie=(e,t)=>{console.log(`%c${ii[e]} ${e.toUpperCase()}%c ${t}`,ni[e],si[e])},ai=class{constructor(e){o(this,"rows");o(this,"tableTypeInfo");o(this,"emitter");o(this,"applyOperations",(e,t)=>{const i=[];if(this.tableTypeInfo.primaryKey!==void 0){const n=this.tableTypeInfo.primaryKey,r=new cr,a=new cr;for(const p of e)if(p.type==="insert"){const[h,y]=r.get(p.row[n])||[p,0];r.set(p.row[n],[p,y+1])}else{const[h,y]=a.get(p.row[n])||[p,0];a.set(p.row[n],[p,y+1])}for(const{key:p,value:[h,y]}of r){const d=a.get(p);if(d){const[b,C]=d,k=y-C,I=this.update(t,h,b,k);I&&i.push(I),a.delete(p)}else{const b=this.insert(t,h,y);b&&i.push(b)}}for(const[p,h]of a.values()){const y=this.delete(t,p,h);y&&i.push(y)}}else for(const n of e)if(n.type==="insert"){const r=this.insert(t,n);r&&i.push(r)}else{const r=this.delete(t,n);r&&i.push(r)}return i});o(this,"update",(e,t,i,n=0)=>{const[r,a]=this.rows.get(i.rowId)||[i.row,0],p=Math.max(1,a+n);return this.rows.delete(i.rowId),this.rows.set(t.rowId,[t.row,p]),a===0?(ie("error","Updating a row that was not present in the cache"),{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,t.row)}}):(a+n<=0&&ie("error","Negative reference count for row"),{type:"update",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("update",e,r,t.row)}})});o(this,"insert",(e,t,i=1)=>{const[n,r]=this.rows.get(t.rowId)||[t.row,0];if(this.rows.set(t.rowId,[t.row,r+i]),r===0)return{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,t.row)}}});o(this,"delete",(e,t,i=1)=>{const[n,r]=this.rows.get(t.rowId)||[t.row,0];if(r===0){ie("warn","Deleting a row that was not present in the cache");return}if(r<=i)return this.rows.delete(t.rowId),{type:"delete",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("delete",e,t.row)}};this.rows.set(t.rowId,[t.row,r-i])});o(this,"onInsert",e=>{this.emitter.on("insert",e)});o(this,"onDelete",e=>{this.emitter.on("delete",e)});o(this,"onUpdate",e=>{this.emitter.on("update",e)});o(this,"removeOnInsert",e=>{this.emitter.off("insert",e)});o(this,"removeOnDelete",e=>{this.emitter.off("delete",e)});o(this,"removeOnUpdate",e=>{this.emitter.off("update",e)});this.tableTypeInfo=e,this.rows=new Map,this.emitter=new it}count(){return this.rows.size}iter(){return Array.from(this.rows.values()).map(([e])=>e)}},ci=class{constructor(){o(this,"tables");this.tables=new Map}getTable(e){const t=this.tables.get(e);if(!t)throw console.error("The table has not been registered for this client. Please register the table before using it. If you have registered global tables using the SpacetimeDBClient.registerTables() or `registerTable()` method, please make sure that is executed first!"),new Error(`Table ${e} does not exist`);return t}getOrCreateTable(e){let t;return this.tables.has(e.tableName)?t=this.tables.get(e.tableName):(t=new ai(e),this.tables.set(e.tableName,t)),t}};async function Ir(e,t,i=128*1024){let n=0;const r=new ReadableStream({pull(I){if(n<e.length){const v=e.subarray(n,Math.min(n+i,e.length));I.enqueue(v),n+=i}else I.close()}}),a=new DecompressionStream(t),h=r.pipeThrough(a).getReader(),y=[];let d=0,b;for(;!(b=await h.read()).done;)y.push(b.value),d+=b.value.length;const C=new Uint8Array(d);let k=0;for(const I of y)C.set(I,k),k+=I.length;return C}var ge,Ke,Ur,Je,_r,_e,Rt,Ce,oi=(Ce=class{constructor(t){m(this,Ke);m(this,Je);m(this,_e);o(this,"onclose");o(this,"onopen");o(this,"onmessage");o(this,"onerror");m(this,ge,void 0);this.onmessage=void 0,this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,t.onmessage=g(this,Ke,Ur).bind(this),t.onerror=g(this,_e,Rt).bind(this),t.onclose=g(this,_e,Rt).bind(this),t.onopen=g(this,Je,_r).bind(this),t.binaryType="arraybuffer",T(this,ge,t)}send(t){s(this,ge).send(t)}close(){s(this,ge).close()}static async createWebSocketFn({url:t,wsProtocol:i,authToken:n,compression:r,lightMode:a}){const p=new Headers;let h;if(h=WebSocket,n){p.set("Authorization",`Bearer ${n}`);const d=new URL("/v1/identity/websocket-token",t);d.protocol=t.protocol==="wss:"?"https:":"http:";const b=await fetch(d,{method:"POST",headers:p});if(b.ok){const{token:C}=await b.json();t.searchParams.set("token",C)}}t.searchParams.set("compression",r==="gzip"?"Gzip":"None"),a&&t.searchParams.set("light","true");const y=new h(t,i);return new Ce(y)}},ge=new WeakMap,Ke=new WeakSet,Ur=async function(t){const i=new Uint8Array(t.data);let n;if(i[0]===0)n=i.slice(1);else{if(i[0]===1)throw new Error("Brotli Compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");if(i[0]===2)n=await Ir(i.slice(1),"gzip");else throw new Error("Unexpected Compression Algorithm. Please use `gzip` or `none`")}this.onmessage?.({data:n})},Je=new WeakSet,_r=function(t){this.onopen?.(t)},_e=new WeakSet,Rt=function(t){this.onerror?.(t)},Ce),he,Te,Ze,Ee,ae,Fe,ke,be,hr,li=(hr=class{constructor(e,t){m(this,he,void 0);m(this,Te,void 0);m(this,Ze,void 0);m(this,Ee,void 0);m(this,ae,new it);m(this,Fe,"gzip");m(this,ke,!1);m(this,be,void 0);this.remoteModule=e,this.dbConnectionConstructor=t,T(this,be,oi.createWebSocketFn)}withUri(e){return T(this,he,new URL(e)),this}withModuleName(e){return T(this,Te,e),this}withToken(e){return T(this,Ee,e),this}withWSFn(e){return T(this,be,e),this}withCompression(e){return T(this,Fe,e),this}withLightMode(e){return T(this,ke,e),this}onConnect(e){return s(this,ae).on("connect",e),this}onConnectError(e){return s(this,ae).on("connectError",e),this}onDisconnect(e){return s(this,ae).on("disconnect",e),this}build(){if(!s(this,he))throw new Error("URI is required to connect to SpacetimeDB");if(!s(this,Te))throw new Error("Database name or address is required to connect to SpacetimeDB");return this.dbConnectionConstructor(new Er({uri:s(this,he),nameOrAddress:s(this,Te),identity:s(this,Ze),token:s(this,Ee),emitter:s(this,ae),compression:s(this,Fe),lightMode:s(this,ke),createWSFn:s(this,be),remoteModule:this.remoteModule}))}},he=new WeakMap,Te=new WeakMap,Ze=new WeakMap,Ee=new WeakMap,ae=new WeakMap,Fe=new WeakMap,ke=new WeakMap,be=new WeakMap,hr),Pe,Oe,Tr,Cr=(Tr=class{constructor(e){m(this,Pe,void 0);m(this,Oe,void 0);this.db=e}onApplied(e){return T(this,Pe,e),this}onError(e){return T(this,Oe,e),this}subscribe(e){const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Subscriptions must have at least one query");return new ui(this.db,t,s(this,Pe),s(this,Oe))}subscribeToAllTables(){this.subscribe("SELECT * FROM *")}},Pe=new WeakMap,Oe=new WeakMap,Tr),pi=class{constructor(){o(this,"subscriptions",new Map)}},fe,ce,j,X,Y,br,ui=(br=class{constructor(e,t,i,n){m(this,fe,void 0);m(this,ce,!1);m(this,j,!1);m(this,X,!1);m(this,Y,new it);this.db=e,s(this,Y).on("applied",r=>{T(this,X,!0),i&&i(r)}),s(this,Y).on("error",(r,a)=>{T(this,X,!1),T(this,j,!0),n&&n(r,a)}),T(this,fe,this.db.registerSubscription(this,s(this,Y),t))}unsubscribe(){if(s(this,ce))throw new Error("Unsubscribe has already been called");T(this,ce,!0),this.db.unregisterSubscription(s(this,fe)),s(this,Y).on("end",e=>{T(this,j,!0),T(this,X,!1)})}unsubscribeThen(e){if(s(this,j))throw new Error("Subscription has already ended");if(s(this,ce))throw new Error("Unsubscribe has already been called");T(this,ce,!0),this.db.unregisterSubscription(s(this,fe)),s(this,Y).on("end",t=>{T(this,j,!0),T(this,X,!1),e(t)})}isEnded(){return s(this,j)}isActive(){return s(this,X)}},fe=new WeakMap,ce=new WeakMap,j=new WeakMap,X=new WeakMap,Y=new WeakMap,br);function di(e){switch(e){case"FullUpdate":return 0;case"NoSuccessNotify":return 1}}var Be,L,me,je,D,Re,W,Xe,Ye,Fr,we,Le,Qe,kr,K,ee,et,Pr,tt,Or,rt,Br,Qt,yi,er,gi,tr,hi,rr,Ti,ir,bi,nr,fi,sr,mi,fr,Er=(fr=class{constructor({uri:e,nameOrAddress:t,identity:i,token:n,emitter:r,remoteModule:a,createWSFn:p,compression:h,lightMode:y}){m(this,Ye);m(this,we);m(this,Qe);m(this,K);m(this,et);m(this,tt);m(this,rt);m(this,Qt);m(this,er);m(this,tr);m(this,rr);m(this,ir);m(this,nr);m(this,sr);o(this,"isActive",!1);o(this,"identity");o(this,"token");o(this,"db");o(this,"reducers");o(this,"setReducerFlags");o(this,"connectionId",at.random());m(this,Be,0);m(this,L,void 0);m(this,me,new it);m(this,je,void 0);m(this,D,void 0);m(this,Re,Promise.resolve());m(this,W,new pi);o(this,"clientCache");o(this,"ws");o(this,"wsPromise");m(this,Xe,()=>{const e=s(this,Be);return T(this,Be,s(this,Be)+1),e});o(this,"subscriptionBuilder",()=>new Cr(this));ie("info","Connecting to SpacetimeDB WS...");let d=new URL(`v1/database/${t}/subscribe`,e);/^wss?:/.test(e.protocol)||(d.protocol="ws:"),this.identity=i,this.token=n,T(this,D,a),T(this,L,r);let b=this.connectionId.toHexString();d.searchParams.set("connection_id",b),this.clientCache=new ci,this.db=s(this,D).dbViewConstructor(this),this.setReducerFlags=s(this,D).setReducerFlagsConstructor(),this.reducers=s(this,D).reducersConstructor(this,this.setReducerFlags),this.wsPromise=p({url:d,wsProtocol:"v1.bsatn.spacetimedb",authToken:n,compression:h,lightMode:y}).then(C=>(this.ws=C,this.ws.onclose=()=>{s(this,L).emit("disconnect",this)},this.ws.onerror=k=>{s(this,L).emit("connectError",this,k)},this.ws.onopen=g(this,Qe,kr).bind(this),this.ws.onmessage=g(this,tt,Or).bind(this),C)).catch(C=>{throw ie("error","Error connecting to SpacetimeDB WS"),g(this,rt,Br).call(this,"connectError",C),C})}registerSubscription(e,t,i){const n=s(this,Xe).call(this);return s(this,W).subscriptions.set(n,{handle:e,emitter:t}),g(this,we,Le).call(this,ue.SubscribeMulti({queryStrings:i,queryId:{id:n},requestId:0})),n}unregisterSubscription(e){g(this,we,Le).call(this,ue.UnsubscribeMulti({queryId:{id:e},requestId:0}))}callReducer(e,t,i){const n=ue.CallReducer({reducer:e,args:t,requestId:0,flags:di(i)});g(this,we,Le).call(this,n)}disconnect(){this.wsPromise.then(e=>{e.close()})}onReducer(e,t){s(this,me).on(e,t)}offReducer(e,t){s(this,me).off(e,t)}},Be=new WeakMap,L=new WeakMap,me=new WeakMap,je=new WeakMap,D=new WeakMap,Re=new WeakMap,W=new WeakMap,Xe=new WeakMap,Ye=new WeakSet,Fr=async function(e){const t=(r,a,p)=>{const h=p.rowsData,y=new de(h),d=[],b=s(this,D).tables[a].rowType;for(;y.offset<h.length+h.byteOffset;){const C=b.deserialize(y),k=JSON.stringify(C,(I,v)=>typeof v=="bigint"?v.toString():v);d.push({type:r,rowId:k,row:C})}return d},i=async r=>{const a=r.tableName;let p=[];for(const h of r.updates){let y;if(h.tag==="Gzip"){const d=await Ir(h.value,"gzip");y=Ne.deserialize(new de(d))}else{if(h.tag==="Brotli")throw new Error("Brotli compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");y=h.value}p=p.concat(t("insert",a,y.inserts)),p=p.concat(t("delete",a,y.deletes))}return{tableName:a,operations:p}},n=async r=>{const a=[];for(const p of r.tables)a.push(await i(p));return a};switch(e.tag){case"InitialSubscription":{const r=e.value.databaseUpdate;return{tag:"InitialSubscription",tableUpdates:await n(r)}}case"TransactionUpdateLight":{const r=e.value.update;return{tag:"TransactionUpdateLight",tableUpdates:await n(r)}}case"TransactionUpdate":{const r=e.value,a=r.callerIdentity,p=at.nullIfZero(r.callerConnectionId),h=r.reducerCall.reducerName,y=r.reducerCall.args,d=r.energyQuantaUsed;let b,C="";switch(r.status.tag){case"Committed":b=await n(r.status.value);break;case"Failed":b=[],C=r.status.value;break;case"OutOfEnergy":b=[];break}if(h==="<none>"){console.error(`Received an error from the database: ${C}`);return}let k;return h!==""&&(k={reducerName:h,args:y}),{tag:"TransactionUpdate",tableUpdates:b,identity:a,connectionId:p,reducerInfo:k,status:r.status,energyConsumed:d.quanta,message:C,timestamp:r.timestamp}}case"IdentityToken":return{tag:"IdentityToken",identity:e.value.identity,token:e.value.token,connectionId:e.value.connectionId};case"OneOffQueryResponse":throw new Error(`TypeScript SDK never sends one-off queries, but got OneOffQueryResponse ${e}`);case"SubscribeMultiApplied":{const r=await n(e.value.update);return{tag:"SubscribeApplied",queryId:e.value.queryId.id,tableUpdates:r}}case"UnsubscribeMultiApplied":{const r=await n(e.value.update);return{tag:"UnsubscribeApplied",queryId:e.value.queryId.id,tableUpdates:r}}case"SubscriptionError":return{tag:"SubscriptionError",queryId:e.value.queryId,error:e.value.error}}},we=new WeakSet,Le=function(e){this.wsPromise.then(t=>{const i=new re(1024);ue.serialize(i,e);const n=i.getBuffer();t.send(n)})},Qe=new WeakSet,kr=function(){this.isActive=!0},K=new WeakSet,ee=function(e,t){const i=[];for(let n of e){const r=n.tableName,a=s(this,D).tables[r],p=this.clientCache.getOrCreateTable(a);i.push(...p.applyOperations(n.operations,t))}return i},et=new WeakSet,Pr=async function(e){var n;const t=ri(Bt,e),i=await g(this,Ye,Fr).call(this,t);if(!!i)switch(i.tag){case"InitialSubscription":{let r={tag:"SubscribeApplied"};const a=s(this,D).eventContextConstructor(this,r),{event:p,...h}=a,y=g(this,K,ee).call(this,i.tableUpdates,a);s(this,L)&&((n=s(this,je))==null||n.call(this,h));for(const d of y)d.cb();break}case"TransactionUpdateLight":{let r={tag:"UnknownTransaction"};const a=s(this,D).eventContextConstructor(this,r),p=g(this,K,ee).call(this,i.tableUpdates,a);for(const h of p)h.cb();break}case"TransactionUpdate":{let r=i.reducerInfo,a=!1,p,h;if(!r)a=!0;else{h=s(this,D).reducers[r.reducerName];try{const v=new de(r.args);p=h.argsType.deserialize(v)}catch{console.debug("Failed to deserialize reducer arguments"),a=!0}}if(a){const v={tag:"UnknownTransaction"},_=s(this,D).eventContextConstructor(this,v),f=g(this,K,ee).call(this,i.tableUpdates,_);for(const z of f)z.cb();return}r=r,h=h;const y={callerIdentity:i.identity,status:i.status,callerConnectionId:i.connectionId,timestamp:i.timestamp,energyConsumed:i.energyConsumed,reducer:{name:r.reducerName,args:p}},d={tag:"Reducer",value:y},b=s(this,D).eventContextConstructor(this,d),C={...b,event:y},k=g(this,K,ee).call(this,i.tableUpdates,b),I=[];h.argsType.product.elements.forEach((v,_)=>{I.push(p[v.name])}),s(this,me).emit(r.reducerName,C,...I);for(const v of k)v.cb();break}case"IdentityToken":{this.identity=i.identity,!this.token&&i.token&&(this.token=i.token),this.connectionId=i.connectionId,s(this,L).emit("connect",this,this.identity,this.token);break}case"SubscribeApplied":{const r=s(this,W).subscriptions.get(i.queryId);if(r===void 0){ie("error",`Received SubscribeApplied for unknown queryId ${i.queryId}.`);break}const a={tag:"SubscribeApplied"},p=s(this,D).eventContextConstructor(this,a),{event:h,...y}=p,d=g(this,K,ee).call(this,i.tableUpdates,p);r?.emitter.emit("applied",y);for(const b of d)b.cb();break}case"UnsubscribeApplied":{const r=s(this,W).subscriptions.get(i.queryId);if(r===void 0){ie("error",`Received UnsubscribeApplied for unknown queryId ${i.queryId}.`);break}const a={tag:"UnsubscribeApplied"},p=s(this,D).eventContextConstructor(this,a),{event:h,...y}=p,d=g(this,K,ee).call(this,i.tableUpdates,p);r?.emitter.emit("end",y),s(this,W).subscriptions.delete(i.queryId);for(const b of d)b.cb();break}case"SubscriptionError":{const r=Error(i.error),a={tag:"Error",value:r},h={...s(this,D).eventContextConstructor(this,a),event:r};i.queryId!==void 0?(s(this,W).subscriptions.get(i.queryId)?.emitter.emit("error",h,r),s(this,W).subscriptions.delete(i.queryId)):(console.error("Received an error message without a queryId: ",r),s(this,W).subscriptions.forEach(({emitter:y})=>{y.emit("error",h,r)}))}}},tt=new WeakSet,Or=function(e){T(this,Re,s(this,Re).then(()=>g(this,et,Pr).call(this,e.data)))},rt=new WeakSet,Br=function(e,t){s(this,L).on(e,t)},Qt=new WeakSet,yi=function(e,t){s(this,L).off(e,t)},er=new WeakSet,gi=function(e){s(this,L).on("connect",e)},tr=new WeakSet,hi=function(e){s(this,L).on("disconnect",e)},rr=new WeakSet,Ti=function(e){s(this,L).on("connectError",e)},ir=new WeakSet,bi=function(e){s(this,L).off("connect",e)},nr=new WeakSet,fi=function(e){s(this,L).off("disconnect",e)},sr=new WeakSet,mi=function(e){s(this,L).off("connectError",e)},fr),xt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(xt||(xt={}));var Dt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Dt||(Dt={}));var Lt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Lt||(Lt={}));var He;(e=>{function t(){return c.createProductType([new l("sender",c.createIdentityType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(He||(He={}));var Mt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Mt||(Mt={}));var Nt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Nt||(Nt={}));var qt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(qt||(qt={}));var $t;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})($t||($t={}));var We;(e=>{function t(){return c.createProductType([new l("receiver",c.createIdentityType()),new l("animal",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(We||(We={}));var Ge;(e=>{function t(){return c.createProductType([new l("receiver",c.createIdentityType()),new l("content",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Ge||(Ge={}));var Ve;(e=>{function t(){return c.createProductType([new l("name",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Ve||(Ve={}));class wi{constructor(t){o(this,"tableCache");o(this,"id",{find:t=>{for(let i of this.tableCache.iter())if(oe(i.id,t))return i}});o(this,"onInsert",t=>this.tableCache.onInsert(t));o(this,"removeOnInsert",t=>this.tableCache.removeOnInsert(t));o(this,"onDelete",t=>this.tableCache.onDelete(t));o(this,"removeOnDelete",t=>this.tableCache.removeOnDelete(t));o(this,"onUpdate",t=>this.tableCache.onUpdate(t));o(this,"removeOnUpdate",t=>this.tableCache.removeOnUpdate(t));this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Si{constructor(t){o(this,"tableCache");o(this,"id",{find:t=>{for(let i of this.tableCache.iter())if(oe(i.id,t))return i}});o(this,"onInsert",t=>this.tableCache.onInsert(t));o(this,"removeOnInsert",t=>this.tableCache.removeOnInsert(t));o(this,"onDelete",t=>this.tableCache.onDelete(t));o(this,"removeOnDelete",t=>this.tableCache.removeOnDelete(t));o(this,"onUpdate",t=>this.tableCache.onUpdate(t));o(this,"removeOnUpdate",t=>this.tableCache.removeOnUpdate(t));this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Ai{constructor(t){o(this,"tableCache");o(this,"onInsert",t=>this.tableCache.onInsert(t));o(this,"removeOnInsert",t=>this.tableCache.removeOnInsert(t));o(this,"onDelete",t=>this.tableCache.onDelete(t));o(this,"removeOnDelete",t=>this.tableCache.removeOnDelete(t));this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class zi{constructor(t){o(this,"tableCache");o(this,"id",{find:t=>{for(let i of this.tableCache.iter())if(oe(i.id,t))return i}});o(this,"onInsert",t=>this.tableCache.onInsert(t));o(this,"removeOnInsert",t=>this.tableCache.removeOnInsert(t));o(this,"onDelete",t=>this.tableCache.onDelete(t));o(this,"removeOnDelete",t=>this.tableCache.removeOnDelete(t));o(this,"onUpdate",t=>this.tableCache.onUpdate(t));o(this,"removeOnUpdate",t=>this.tableCache.removeOnUpdate(t));this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class vi{constructor(t){o(this,"tableCache");o(this,"onInsert",t=>this.tableCache.onInsert(t));o(this,"removeOnInsert",t=>this.tableCache.removeOnInsert(t));o(this,"onDelete",t=>this.tableCache.onDelete(t));o(this,"removeOnDelete",t=>this.tableCache.removeOnDelete(t));this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Ii{constructor(t){o(this,"tableCache");o(this,"onInsert",t=>this.tableCache.onInsert(t));o(this,"removeOnInsert",t=>this.tableCache.removeOnInsert(t));o(this,"onDelete",t=>this.tableCache.onDelete(t));o(this,"removeOnDelete",t=>this.tableCache.removeOnDelete(t));this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Ui{constructor(t){o(this,"tableCache");o(this,"id",{find:t=>{for(let i of this.tableCache.iter())if(oe(i.id,t))return i}});o(this,"name",{find:t=>{for(let i of this.tableCache.iter())if(oe(i.name,t))return i}});o(this,"onInsert",t=>this.tableCache.onInsert(t));o(this,"removeOnInsert",t=>this.tableCache.removeOnInsert(t));o(this,"onDelete",t=>this.tableCache.onDelete(t));o(this,"removeOnDelete",t=>this.tableCache.removeOnDelete(t));o(this,"onUpdate",t=>this.tableCache.onUpdate(t));o(this,"removeOnUpdate",t=>this.tableCache.removeOnUpdate(t));this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class _i{constructor(t){o(this,"tableCache");o(this,"receiver",{find:t=>{for(let i of this.tableCache.iter())if(oe(i.receiver,t))return i}});o(this,"onInsert",t=>this.tableCache.onInsert(t));o(this,"removeOnInsert",t=>this.tableCache.removeOnInsert(t));o(this,"onDelete",t=>this.tableCache.onDelete(t));o(this,"removeOnDelete",t=>this.tableCache.removeOnDelete(t));o(this,"onUpdate",t=>this.tableCache.onUpdate(t));o(this,"removeOnUpdate",t=>this.tableCache.removeOnUpdate(t));this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var Ht;(e=>{e.Dublicate={tag:"Dublicate"},e.Levelup={tag:"Levelup"},e.Dead={tag:"Dead"},e.Stay={tag:"Stay"};function t(){return c.createSumType([new E("Dublicate",c.createProductType([])),new E("Levelup",c.createProductType([])),new E("Dead",c.createProductType([])),new E("Stay",c.createProductType([]))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Ht||(Ht={}));var Wt;(e=>{function t(){return c.createProductType([new l("animal",c.createU32Type()),new l("action",Ht.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Wt||(Wt={}));var Gt;(e=>{function t(){return c.createProductType([new l("id",c.createIdentityType()),new l("target",c.createIdentityType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Gt||(Gt={}));var Vt;(e=>{function t(){return c.createProductType([new l("id",c.createIdentityType()),new l("secretSeed",c.createU128Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Vt||(Vt={}));var Kt;(e=>{function t(){return c.createProductType([new l("sender",c.createIdentityType()),new l("receiver",c.createIdentityType()),new l("animal",c.createU32Type()),new l("timestamp",c.createU64Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Kt||(Kt={}));var Jt;(e=>{function t(){return c.createProductType([new l("id",c.createIdentityType()),new l("timestamp",c.createU64Type()),new l("rollingAverage",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Jt||(Jt={}));var Zt;(e=>{function t(){return c.createProductType([new l("sender",c.createIdentityType()),new l("receiver",c.createIdentityType()),new l("content",c.createStringType()),new l("timestamp",c.createU64Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Zt||(Zt={}));var jt;(e=>{function t(){return c.createProductType([new l("sender",c.createIdentityType()),new l("receiver",c.createIdentityType()),new l("amount",c.createU32Type()),new l("timestamp",c.createU64Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(jt||(jt={}));var Xt;(e=>{function t(){return c.createProductType([new l("id",c.createIdentityType()),new l("name",c.createStringType()),new l("highscore",c.createU32Type()),new l("highscoreState",c.createArrayType(c.createU32Type())),new l("bank",c.createU32Type()),new l("gameState",c.createArrayType(c.createU32Type())),new l("lastActionResult",c.createArrayType(Wt.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Xt||(Xt={}));var Yt;(e=>{function t(){return c.createProductType([new l("receiver",c.createIdentityType()),new l("senders",c.createArrayType(c.createIdentityType()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function n(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=n})(Yt||(Yt={}));const V={tables:{followers:{tableName:"followers",rowType:Gt.getTypeScriptAlgebraicType(),primaryKey:"id"},game_state:{tableName:"game_state",rowType:Vt.getTypeScriptAlgebraicType(),primaryKey:"id"},gifts:{tableName:"gifts",rowType:Kt.getTypeScriptAlgebraicType()},lastaction:{tableName:"lastaction",rowType:Jt.getTypeScriptAlgebraicType(),primaryKey:"id"},messages:{tableName:"messages",rowType:Zt.getTypeScriptAlgebraicType()},payments:{tableName:"payments",rowType:jt.getTypeScriptAlgebraicType()},person:{tableName:"person",rowType:Xt.getTypeScriptAlgebraicType(),primaryKey:"id"},unread:{tableName:"unread",rowType:Yt.getTypeScriptAlgebraicType(),primaryKey:"receiver"}},reducers:{create_person:{reducerName:"create_person",argsType:xt.getTypeScriptAlgebraicType()},identity_connected:{reducerName:"identity_connected",argsType:Dt.getTypeScriptAlgebraicType()},identity_disconnected:{reducerName:"identity_disconnected",argsType:Lt.getTypeScriptAlgebraicType()},mark_read:{reducerName:"mark_read",argsType:He.getTypeScriptAlgebraicType()},play_green:{reducerName:"play_green",argsType:Mt.getTypeScriptAlgebraicType()},play_red:{reducerName:"play_red",argsType:Nt.getTypeScriptAlgebraicType()},reset_bank:{reducerName:"reset_bank",argsType:qt.getTypeScriptAlgebraicType()},sell_game_worth:{reducerName:"sell_game_worth",argsType:$t.getTypeScriptAlgebraicType()},send_gift:{reducerName:"send_gift",argsType:We.getTypeScriptAlgebraicType()},send_message:{reducerName:"send_message",argsType:Ge.getTypeScriptAlgebraicType()},set_person_name:{reducerName:"set_person_name",argsType:Ve.getTypeScriptAlgebraicType()}},eventContextConstructor:(e,t)=>({...e,event:t}),dbViewConstructor:e=>new Fi(e),reducersConstructor:(e,t)=>new Ci(e,t),setReducerFlagsConstructor:()=>new Ei};class Ci{constructor(t,i){this.connection=t,this.setCallReducerFlags=i}createPerson(){this.connection.callReducer("create_person",new Uint8Array(0),this.setCallReducerFlags.createPersonFlags)}onCreatePerson(t){this.connection.onReducer("create_person",t)}removeOnCreatePerson(t){this.connection.offReducer("create_person",t)}onIdentityConnected(t){this.connection.onReducer("identity_connected",t)}removeOnIdentityConnected(t){this.connection.offReducer("identity_connected",t)}onIdentityDisconnected(t){this.connection.onReducer("identity_disconnected",t)}removeOnIdentityDisconnected(t){this.connection.offReducer("identity_disconnected",t)}markRead(t){const i={sender:t};let n=new re(1024);He.getTypeScriptAlgebraicType().serialize(n,i);let r=n.getBuffer();this.connection.callReducer("mark_read",r,this.setCallReducerFlags.markReadFlags)}onMarkRead(t){this.connection.onReducer("mark_read",t)}removeOnMarkRead(t){this.connection.offReducer("mark_read",t)}playGreen(){this.connection.callReducer("play_green",new Uint8Array(0),this.setCallReducerFlags.playGreenFlags)}onPlayGreen(t){this.connection.onReducer("play_green",t)}removeOnPlayGreen(t){this.connection.offReducer("play_green",t)}playRed(){this.connection.callReducer("play_red",new Uint8Array(0),this.setCallReducerFlags.playRedFlags)}onPlayRed(t){this.connection.onReducer("play_red",t)}removeOnPlayRed(t){this.connection.offReducer("play_red",t)}resetBank(){this.connection.callReducer("reset_bank",new Uint8Array(0),this.setCallReducerFlags.resetBankFlags)}onResetBank(t){this.connection.onReducer("reset_bank",t)}removeOnResetBank(t){this.connection.offReducer("reset_bank",t)}sellGameWorth(){this.connection.callReducer("sell_game_worth",new Uint8Array(0),this.setCallReducerFlags.sellGameWorthFlags)}onSellGameWorth(t){this.connection.onReducer("sell_game_worth",t)}removeOnSellGameWorth(t){this.connection.offReducer("sell_game_worth",t)}sendGift(t,i){const n={receiver:t,animal:i};let r=new re(1024);We.getTypeScriptAlgebraicType().serialize(r,n);let a=r.getBuffer();this.connection.callReducer("send_gift",a,this.setCallReducerFlags.sendGiftFlags)}onSendGift(t){this.connection.onReducer("send_gift",t)}removeOnSendGift(t){this.connection.offReducer("send_gift",t)}sendMessage(t,i){const n={receiver:t,content:i};let r=new re(1024);Ge.getTypeScriptAlgebraicType().serialize(r,n);let a=r.getBuffer();this.connection.callReducer("send_message",a,this.setCallReducerFlags.sendMessageFlags)}onSendMessage(t){this.connection.onReducer("send_message",t)}removeOnSendMessage(t){this.connection.offReducer("send_message",t)}setPersonName(t){const i={name:t};let n=new re(1024);Ve.getTypeScriptAlgebraicType().serialize(n,i);let r=n.getBuffer();this.connection.callReducer("set_person_name",r,this.setCallReducerFlags.setPersonNameFlags)}onSetPersonName(t){this.connection.onReducer("set_person_name",t)}removeOnSetPersonName(t){this.connection.offReducer("set_person_name",t)}}class Ei{constructor(){o(this,"createPersonFlags","FullUpdate");o(this,"markReadFlags","FullUpdate");o(this,"playGreenFlags","FullUpdate");o(this,"playRedFlags","FullUpdate");o(this,"resetBankFlags","FullUpdate");o(this,"sellGameWorthFlags","FullUpdate");o(this,"sendGiftFlags","FullUpdate");o(this,"sendMessageFlags","FullUpdate");o(this,"setPersonNameFlags","FullUpdate")}createPerson(t){this.createPersonFlags=t}markRead(t){this.markReadFlags=t}playGreen(t){this.playGreenFlags=t}playRed(t){this.playRedFlags=t}resetBank(t){this.resetBankFlags=t}sellGameWorth(t){this.sellGameWorthFlags=t}sendGift(t){this.sendGiftFlags=t}sendMessage(t){this.sendMessageFlags=t}setPersonName(t){this.setPersonNameFlags=t}}class Fi{constructor(t){this.connection=t}get followers(){return new wi(this.connection.clientCache.getOrCreateTable(V.tables.followers))}get gameState(){return new Si(this.connection.clientCache.getOrCreateTable(V.tables.game_state))}get gifts(){return new Ai(this.connection.clientCache.getOrCreateTable(V.tables.gifts))}get lastaction(){return new zi(this.connection.clientCache.getOrCreateTable(V.tables.lastaction))}get messages(){return new vi(this.connection.clientCache.getOrCreateTable(V.tables.messages))}get payments(){return new Ii(this.connection.clientCache.getOrCreateTable(V.tables.payments))}get person(){return new Ui(this.connection.clientCache.getOrCreateTable(V.tables.person))}get unread(){return new _i(this.connection.clientCache.getOrCreateTable(V.tables.unread))}}class ki extends Cr{}class Rr extends Er{constructor(){super(...arguments);o(this,"subscriptionBuilder",()=>new ki(this))}}o(Rr,"builder",()=>new li(V,i=>i));function A(e,t={},i=""){const n=document.createElement(e);for(const[r,a]of Object.entries(t))a instanceof HTMLElement?r==="parentElement"&&a.appendChild(n):n.setAttribute(r,a);return n.textContent=i,n}function Pi(){const e=A("div",{class:"prompt_window"}),t=A("div",{class:"prompt_inner",parentElement:e});return e.addEventListener("click",i=>{e.remove()}),document.body.appendChild(e),t}const Oi=100,$=["\u{1F42D}","\u{1F439}","\u{1F431}","\u{1F436}","\u{1F43B}","\u{1F42F}","\u{1F981}","\u{1F43C}","\u{1F438}","\u{1F432}"];function Bi(e){function t(){if(e.player.get().bank==0){let _=window.prompt("You have no money left, say please to get more");_&&_.length>0&&(e.conn.reducers.resetBank(),e.updatePlayer(!0))}}t();let i=A("div",{id:"game"});const n=A("p",{parentElement:i}),r=A("div",{id:"animals",parentElement:i});r.className="animals";const a=A("p",{parentElement:i},"Highscore: 0$"),p=A("button",{id:"button1",parentElement:i},"Beef \u{1F356}"),h=A("button",{id:"button2",parentElement:i},"Broc \u{1F966}");A("p",{parentElement:i});const y=A("button",{id:"sellbutton",parentElement:i},"Sell");class d{constructor(f){o(this,"element");o(this,"type");this.element=A("div",{},$[f]),this.element.classList.add("animal"),setTimeout(()=>{this.element.classList.add("active")},10),this.type=f}settype(f){this.element.textContent=$[f],this.type=f}update(f){const z=(U=this.element)=>{U.classList.add("fresh"),setTimeout(()=>{U.classList.remove("fresh")},100)};if(f.action.tag=="Dead")return this.element.classList.add("animal","dead"),setTimeout(()=>{this.element.remove()},1e3),[];if(f.action.tag=="Dublicate"){const U=new d(this.type);return z(),z(U.element),this.element.insertAdjacentElement("afterend",U.element),[this,U]}else{if(f.action.tag=="Levelup")return this.type=this.type+1,this.element.classList.remove("active"),setTimeout(()=>{this.element.textContent=$[this.type],this.element.classList.add("active")},100),[this];if(f.action.tag=="Stay")return z(),[this]}return console.error("Unknown action type",f.action),[this]}}let b=[];const C=_=>{r.innerHTML="",b=_.map(f=>{const z=new d(f);return r.appendChild(z.element),z})};e.player.subscribe(_=>{{const f=_.gameState.reduce((z,U)=>z+2**U,0);f>_.highscore?y.classList.add("active"):y.classList.remove("active"),y.textContent=`Collect ${f}$`}n.textContent=`bank: ${_.bank}$`,_.lastActionResult.length==b.length&&_.lastActionResult.every((f,z)=>f.animal===b[z].type)?(console.log("merging actions"),b=_.lastActionResult.flatMap((z,U)=>b[U].update(z)),b.length==0&&(b.push(new d(0)),r.appendChild(b[0].element))):C(_.gameState),a.textContent=`Highscore: ${_.highscoreState.reduce((f,z)=>f+$[z],"")}`}),p.classList.add("bigbutton"),h.classList.add("bigbutton"),y.classList.add("bigbutton");let k=!1,I=null;const v=_=>{if(k){I=_;return}k=!0,_(),e.updatePlayer(!0),t(),setTimeout(()=>{k=!1,I&&(v(I),I=null)},Oi)};return p.addEventListener("click",_=>{_.preventDefault(),v(()=>e.conn.reducers.playRed())}),h.addEventListener("click",_=>{_.preventDefault(),v(()=>e.conn.reducers.playGreen())}),y.addEventListener("click",_=>{_.preventDefault(),v(()=>e.conn.reducers.sellGameWorth())}),i}function Ri(e){const t=A("div",{class:"leaderboard"});A("h2",{parentElement:t},"Leaderboard");const i=A("h3",{},"Change your name, currently: "),n=A("span",{},e.player.get().name);n.style.textDecoration="underline",i.appendChild(n),t.appendChild(i),i.addEventListener("click",()=>{const a=window.prompt("Your name:",e.player.get().name)?.trim();a&&a.length>0&&e.conn.reducers.setPersonName(a)}),e.player.subscribe(a=>{n.textContent=`${a.name.slice(0,20)}`});const r=A("div",{});return e.competition.subscribe(a=>{r.innerHTML="",a.sort((p,h)=>h.highscore-p.highscore).slice(0,100);for(const[p,h]of a.entries()){const y=A("p",{class:"leaderitem"});y.innerHTML=`<span class=nametag>${p+1}. ${h.name.slice(0,20)}</span>: ${h.highscore}$ : ${h.highscoreState.reduce((d,b)=>d+$[b],"")}`,y.addEventListener("click",()=>{e.goto(`/user/${h.name}`)}),r.appendChild(y)}}),t.appendChild(r),t}function xi(e,t,i,n,r){const a=A("div",{id:"chat"}),p=A("div",{id:"user_card",parentElement:a}),h=A("h2",{parentElement:p}),y=p.appendChild(A("p",{},""));t.subscribe(I=>{h.innerText=`Chat with ${I.name}`,y.textContent=`bank: ${I.bank}$ highscore: ${I.highscore}$ ${I.highscoreState.reduce((v,_)=>v+$[_],"")} Game: ${I.gameState.reduce((v,_)=>v+$[_],"")}`});const d=A("div",{id:"messages",parentElement:a});i.subscribe(I=>{d.innerHTML="",I.forEach(v=>{const _=v.sender.data===e.get().id.data?"me":t.get()?.name||"Unknown";A("p",{parentElement:A("p",{parentElement:d,class:(_==="me"?"msg me":"msg")+(v.type==="gift"?" gift":"")})},v.type==="message"?v.content:$[v.animal])}),d.scrollTo({top:d.scrollHeight,behavior:"instant"})});const b=A("button",{parentElement:a,id:"gift_button"},"\u{1F381}"),C=A("button",{parentElement:a,id:"send_button"},""),k=A("textarea",{parentElement:a,id:"chat_input"});return k.placeholder="Type your message here...",k.addEventListener("keydown",I=>{if(I.key==="Enter"&&!I.shiftKey){I.preventDefault();const v=k.value.trim();v&&(n(v),k.value="")}}),C.addEventListener("click",()=>{const I=k.value.trim();I&&(n(I),k.value="")}),b.addEventListener("click",()=>{const I=Pi();I.appendChild(A("h2",{},"Choose a gift:"));for(let v=0;v<$.length;v++){const _=A("p",{class:"option"},`${$[v]} ${2**v}$`);I.appendChild(_),_.addEventListener("click",()=>{r(v)})}}),{element:a,scrollToBottom:()=>{d.scrollTo({top:d.scrollHeight,behavior:"instant"})}}}function Di(e,t,i){const n=A("div",{id:"sessions_view"}),r=A("div",{id:"sessions",parentElement:n}),a=(p,h)=>{r.innerHTML="",p.length===0&&A("p",{parentElement:r},"No chats yet."),p.forEach(y=>{const d=A("div",{parentElement:r,class:"session"});d.addEventListener("click",()=>{i(`/user/${y.sender}`)}),A("p",{parentElement:d,class:"session_tag"},y.sender.slice(0,20)),h.get(y.senderId)&&A("span",{parentElement:d,class:"unread"},`${h.get(y.senderId)} `),A("span",{parentElement:d,class:"session_msg"},y.item.type==="message"?y.item.content:`\u{1F381} ${$[y.item.animal]}`)}),A("button",{class:"bigbutton green",parentElement:r},"new chat").addEventListener("click",y=>{const d=window.prompt("enter username");d&&i("/user/"+d)})};return e.subscribe(p=>{a(p,t.get())}),t.subscribe(p=>{a(e.get(),p)}),n}function ar(e,t){return new Promise((i,n)=>{e.subscriptionBuilder().onApplied(r=>{const a=Array.from(r.db.person.iter());i(a)}).onError(r=>{console.error("Error in requestPerson:",r),n(r)}).subscribe(t)})}function Li(e,t){return new Promise((i,n)=>{ar(e,`SELECT * FROM person WHERE name == '${t}'`).then(r=>{r=r.filter(a=>a.name===t),r.length>0?i(r[0]):n(new Error(`Player with name ${t} not found`))})})}function Me(e,t){return new Promise((i,n)=>{ar(e,`SELECT * FROM person WHERE id == '${t.toHexString()}'`).then(r=>{r=r.filter(a=>a.id.data===t.data),r.length>0?i(r[0]):n(new Error(`Player with id ${t.toHexString()} not found`))}).catch(n)})}function or(e){return ar(e,"SELECT * FROM person WHERE highscore > 0")}function Mi(e){const t=new J([]),i=new J(e.player.get()),n=new J(new Map),r=new J([]),a=new J(new Map),p=Di(t,a,e.goto),h=e.player.get().id,y=h.toHexString();n.subscribeLater(async f=>{r.set(f.get(i.get().id.data)??[]),t.set((await Promise.all(f.entries().map(async([z,U])=>{let q=await Me(e.conn,new zr(z)).then(nt=>nt.name).catch(()=>{console.log("Could not find player with id",z,"falling back to unknown")});return{item:U[U.length-1],sender:q,senderId:z}}))).sort((z,U)=>U.item.timestamp<z.item.timestamp?-1:1))}),i.subscribeLater(f=>{e.conn.reducers.markRead(f.id);const z=n.get().get(f.id.data)??[];console.log(z),r.set(z)});const d=f=>{if(f.sender.data!==h.data&&f.receiver.data!=h.data)return console.log("Ignoring message not for this player:",f);const z=f.sender.data==h.data?f.receiver:f.sender;n.update(U=>(U.set(z.data,(U.get(z.data)??[]).concat(f).sort((q,nt)=>q.timestamp>nt.timestamp?1:-1)),U),!0)},b=f=>{d({...f,type:"message"})},C=f=>d({...f,type:"gift"}),k=f=>{if(f.receiver.data!=h.data)return;let z=new Map;f.senders.forEach(U=>{U.data!=i.get().id.data&&z.set(U.data,(z.get(U.data)??0)+1)}),a.set(z)};e.conn.subscriptionBuilder().onApplied(f=>{f.db.messages.onInsert((z,U)=>{b(U)}),f.db.gifts.onInsert((z,U)=>{C(U)}),f.db.unread.onInsert((z,U)=>{k(U)}),f.db.unread.onUpdate((z,U,q)=>{k(q)})}).onError(f=>console.error("Error in chat subscription:",f)).subscribe([`SELECT * FROM messages WHERE receiver == '${y}' OR sender == '${y}'`,`SELECT * FROM gifts WHERE receiver == '${y}' OR sender == '${y}'`,`SELECT * FROM unread WHERE receiver == '${y}'`]);const I=e.conn.subscriptionBuilder().onApplied(f=>{f.db.person.onUpdate((z,U,q)=>{q.id.data==i.get().id.data?(console.log("partner update",q.name),i.set(q)):console.log("non partner update",q.name)}),f.db.person.onInsert((z,U)=>{U.id.data===h.data&&(console.log("partner insert",U.name),i.set(U))})}).onError(f=>{console.error("Error in partner subscription:",f)});let v=null;const _=f=>{Li(e.conn,f).then(z=>{i.set(z);let U=I.subscribe(`SELECT * FROM person WHERE name == '${f}'`);v&&v.unsubscribe(),v=U})};return{sessionsView:p,chatView:f=>(_(f),xi(e.player,i,r,z=>{e.conn.reducers.sendMessage(i.get().id,z)},z=>{e.conn.reducers.sendGift(i.get().id,z)})),unread:a}}const xr="pandadb2",Dr=window.location.pathname.split("/").includes("local")?"local":"remote",lr=new Hr(xr+Dr+"-token",""),Ae=console.log,Ni=e=>{console.error("Panic:",e),alert("ERROR: "+e)},Lr=A("div",{parentElement:document.body,id:"head"}),qi=A("h2",{parentElement:Lr,id:"title"},"Panda Farm"),xe=A("nav",{parentElement:Lr,id:"navbar"}),te=A("div",{id:"page",parentElement:document.body}),$i=A("h1",{parentElement:te},"Waiting for connection..."),pr=()=>Mr(),Hi=Dr=="local"?"ws://localhost:3000":"wss://maincloud.spacetimedb.com";function Mr(){return Rr.builder().withUri(Hi).withModuleName(xr).withToken(lr.get()).onConnect(async(e,t,i)=>{await or(e);const n=await Me(e,t).catch(async d=>(Ae("No player found, creating new player",d),e.reducers.createPerson(),await Me(e,t).catch(b=>{throw Ni("Error: Player not created: "+b.message),b})));Ae("Connected as",n.name,"with id",n.id.toHexString());const r=new J(n),a=new J([]);await or(e);const p=()=>{a.set(Array.from(e.db.person.iter()).filter(d=>d.highscore>0).sort((d,b)=>b.highscore-d.highscore))},h=(d=!1)=>Me(e,n.id).then(()=>{r.set(e.db.person.id.find(n.id),d)});lr.set(i),p(),e.reducers.onSellGameWorth(d=>{p()});const y={conn:e,player:r,goto:d=>{Nr(d)},updatePlayer:h,competition:a};e.reducers.onSendGift(d=>{y.updatePlayer(),p()}),e.reducers.onSetPersonName(d=>{y.updatePlayer(),p()}),$i.remove(),document.body.removeEventListener("click",pr),Gi(y)}).onConnectError((e,t)=>{Ae("onConnectError",t),document.body.addEventListener("click",pr)}).build()}Mr();const Wi=window.location.pathname.split("/").filter(e=>["pandafarm","local"].includes(e)).join("/")+"/";function Nr(e){e=Wi+e,e=e.split("/").filter(t=>t.length>0).join("/"),e=window.origin+"/"+e,Ae("Goto",e),window.history.pushState({},"",e)}function Gi(e){const t=Ri(e),i=Bi(e);e.goto=d=>{Nr(d),y(d)};const{sessionsView:n,chatView:r,unread:a}=Mi(e);xe.innerHTML="";const p=A("span",{parentElement:xe,id:"homebutn"},"home ");p.onclick=()=>{e.goto("/")};const h=A("span",{parentElement:xe,id:"msgbutn"},"messages");h.onclick=()=>{e.goto("/chat")},a.subscribe(d=>{h.innerHTML="messages";const b=Array.from(d).length;b>0&&h.appendChild(A("span",{class:"unread",style:"color:white"},`${b}`))});function y(d){let b=d.split("/").filter(C=>C.length>0);if(xe.querySelectorAll(".active").forEach(C=>C.classList.remove("active")),te.innerHTML="",b[0]=="pandafarm"&&(b=b.slice(1)),b[0]=="local"&&(b=b.slice(1)),b.length==0){p.classList.add("active"),te.appendChild(i),te.appendChild(t);return}if(b[0]=="user"){if(b[1]!=null){const{element:C,scrollToBottom:k}=r(b[1]);te.appendChild(C),k();return}}else if(b[0]=="chat"){h.classList.add("active"),te.appendChild(n);return}te.appendChild(A("h1",{},"Page not found"))}window.addEventListener("popstate",d=>{Ae("Popstate event",d),y(window.location.pathname)}),y(window.location.pathname),qi.onclick=()=>e.goto("/")}
